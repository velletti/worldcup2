
{namespace jve=JVE\Worldcup2\ViewHelpers}
{namespace vhs=FluidTYPO3\Vhs\ViewHelpers}

<f:layout name="default" />

<f:section name="main">

    <div data-template="extension" >
        <f:render partial="Steps" arguments="{stepindicators: stepindicators}"></f:render>
        <f:if condition="{currentUser}">
            <h3 data-userid="{currentUser.id}">
                Result {currentUser.username}: <f:if condition="{currentUserResult}"><span class="bold p-1">{currentUserResult.points} Points</span></f:if>
                <span class="small"> ({lastUpdated})</span>
            </h3>
        </f:if>
        <f:if condition="{filter}">
            <f:then>
                <div class="alert alert-info">
                    FILTER: {filter}
                </div>
            </f:then>

            <f:else></f:else>
        </f:if>

        <f:if condition="{rankings}">
            <f:then>


                <div class="row  worldcup-game worldcup-gametitle alert alert-default">
                    <f:spaceless>
                        <span class="col-xs-1 p-1"> </span>
                        <span class="col-xs-1 p-1 bold">Pos.</span>
                        <span class="col-xs-1 p-1 "> </span>
                        <span class="col-xs-5 col-sm-3 p-1 worldcup-player bold">Player</span>
                        <span class="col-xs-2 p-1 bold">Points</span>
                        <span class="col-xs-2 p-1" title="{lastGameText}">
                            <f:render partial="Flag" arguments="{team: lastGame.team1}"/>:<f:render partial="Flag" arguments="{team: lastGame.team2}"/>
                            <br>
                            {lastGame.goalsteam1}:{lastGame.goalsteam2}
                        </span>
                        <span class="col-sm-2 p-1 hidden-xs" title="{secondGameText}">
                            <f:render partial="Flag" arguments="{team: secondGame.team1}"/>:<f:render partial="Flag" arguments="{team: secondGame.team2}"/>
                            <br>
                            {secondGame.goalsteam1}:{secondGame.goalsteam2}
                        </span>
                    </f:spaceless>
                </div>
                <f:for as="ranking" each="{rankings}">

                    <div class="row worldcup-ranking {f:if(condition: '{ranking.uid} == {currentUser.id}' , then: ' alert alert-info mt-0 mb-0 p-0 ')}">
                        <f:spaceless>
                            <span class="col-xs-1 p-1">
                                 <f:if condition="{settings.flexform.showDomain}">
                                     <f:then>
                                        <i class="userIcon userIcon-small {ranking.usericon}" alt="icon" title="{f:translate(key: 'LLL:EXT:nemconnections.{ranking.usericon}_public_view')}"></i>
                                     </f:then>
                                     <f:else>
                                        <f:link.page additionalParams="{tx_worldcup2_play: {filter: 'USERTYP'}}">
                                            <i class="userIcon userIcon-small {ranking.usericon}" alt="icon" title="{f:translate(key: 'LLL:EXT:nemconnections.{ranking.usericon}_public_view')}"></i>
                                        </f:link.page>
                                     </f:else>
                                 </f:if>
                            </span>

                            <span class="col-xs-1 p-1 bold">{ranking.pos}</span>
                            <span class="col-xs-1 mx-2 p-1">
                                <f:link.page additionalParams="{tx_worldcup2_play: {filter: 'COUNTRY-{ranking.flag}'}}">
                                    <i class="flag flag-{ranking.flag}" title="{ranking.flag}"></i>
                                </f:link.page>
                            </span>
                            <span class="col-xs-5 col-sm-3 p-1 worldcup-player">
                                <f:if condition="{settings.flexform.showDomain}">
                                    <f:link.page additionalParams="{tx_worldcup2_play: {filter: 'KD-NUM--{ranking.domain}'}}">
                                        [{ranking.domain}]
                                    </f:link.page>

                                </f:if>
                                <f:link.page  pageUid="{settings.pids.listgames}"

                                             additionalParams="{tx_worldcup2_play: {user: ranking.uid}}">

                                    <f:if condition="{settings.showFullname}">
                                        <f:then>{ranking.tx_nem_firstname} {ranking.tx_nem_lastname}</f:then>
                                        <f:else>{ranking.username} </f:else>
                                    </f:if>
                             </f:link.page>
                            </span>
                            <span class="col-xs-2 p-1" title="Got {ranking.points} with {ranking.BetsTotal} Bets">{ranking.points}</span>
                            <f:render section="lastgame" arguments="{bet: ranking.lastBet}"/>
                            <f:render section="lastgame" arguments="{bet: ranking.secondBet, class: ' hidden-xs'}"/>
                        </f:spaceless>
                    </div>
                </f:for>

                <f:security.ifHasRole role="44">
                    <div class="row mt-3">
                        <div class="col-xs-4">
                            {start} - {end} / {playerTotal}
                        </div>
                        <div class="col-xs-8">
                            <div class="right">
                                <f:link.page class="btn btn-default" additionalParams="{tx_worldcup2_play: {start: '0'}}">
                                   <span class="visible-sm visible-md visible-lg hidden-xs">1-50</span><span class="visible-xs hidden-sm hidden-md hidden-lg ">1</span>
                                </f:link.page>
                                <f:if condition="{playerTotal} > 50">
                                    <f:link.page class="btn btn-default" additionalParams="{tx_worldcup2_play: {start: '50'}}">
                                        <span class="visible-sm visible-md visible-lg hidden-xs">51-100</span><span class="visible-xs hidden-sm hidden-md hidden-lg ">2</span>
                                    </f:link.page>
                                </f:if>
                                <f:if condition="{playerTotal} > 100">
                                    <f:link.page class="btn btn-default" additionalParams="{tx_worldcup2_play: {start: '100'}}">
                                        <span class="visible-sm visible-md visible-lg hidden-xs">101-150</span><span class="visible-xs hidden-sm hidden-md hidden-lg ">3</span>
                                    </f:link.page>
                                </f:if>
                                <f:if condition="{start} < 200">
                                    <f:then>
                                        <f:if condition="{playerTotal} > 150">
                                            <f:then>
                                            <f:link.page class="btn btn-default" additionalParams="{tx_worldcup2_play: {start: '150'}}">
                                                <span class="visible-sm visible-md visible-lg hidden-xs">151-200</span><span class="visible-xs hidden-sm hidden-md hidden-lg ">4</span>
                                            </f:link.page>
                                            </f:then>
                                            <f:else>
                                              ..
                                            </f:else>
                                        </f:if>
                                    </f:then>
                                </f:if>
                                <f:if condition="{start} < 250">
                                    <f:if condition="{playerTotal} > 200">
                                        <f:then>
                                            <f:link.page class="btn btn-default" additionalParams="{tx_worldcup2_play: {start: '200'}}">
                                                <span class="visible-sm visible-md visible-lg hidden-xs">201-250</span><span class="visible-xs hidden-sm hidden-md hidden-lg ">5</span>
                                            </f:link.page>
                                        </f:then>
                                        <f:else>
                                            ..
                                        </f:else>
                                    </f:if>
                                </f:if>

                                <f:if condition="{playerTotal} > 250">
                                    <f:link.page class="btn btn-default" additionalParams="{tx_worldcup2_play: {start: '250'}}">
                                        <span class="visible-sm visible-md visible-lg hidden-xs">251-300</span><span class="visible-xs hidden-sm hidden-md hidden-lg ">6</span>
                                    </f:link.page>
                                </f:if>
                                <f:if condition="{start} > 150">
                                    <f:then>
                                        <f:if condition="{playerTotal} > 300">
                                            <f:then>
                                                <f:link.page class="btn btn-default" additionalParams="{tx_worldcup2_play: {start: '300'}}">
                                                    <span class="visible-sm visible-md visible-lg hidden-xs">301-350</span><span class="visible-xs hidden-sm hidden-md hidden-lg ">6</span>
                                                </f:link.page>
                                            </f:then>
                                            <f:else>
                                                ..
                                            </f:else>
                                        </f:if>
                                        <f:if condition="{playerTotal} > 350">
                                            <f:link.page class="btn btn-default" additionalParams="{tx_worldcup2_play: {start: '350'}}">
                                                <span class="visible-sm visible-md visible-lg hidden-xs">351-400</span><span class="visible-xs hidden-sm hidden-md hidden-lg ">7</span>
                                            </f:link.page>
                                        </f:if>
                                    </f:then>


                                </f:if>
                            </div>
                        </div>
                    </div>
                </f:security.ifHasRole>

            </f:then>
            <f:else>
            <div class="alert alert-info">
                <h3>
                    <f:translate key="noranking" default="No Ranking yet"/>
                </h3>

                <p>
                    <f:translate key="noranking.subline" default="coming soon"/>
                </p>
            </div>
            </f:else>
        </f:if>

    </div>
</f:section>

<f:section name="lastgame">

    <f:if condition="{bet}">
        <f:then>
            <span class="p-1 col-xs-2 {class}" title="{bet.game}  = {bet.goalsTeam1}:{bet.goalsTeam2} => {bet.points} Points">
                <f:switch expression="{bet.points}">
                    <f:case value="0"><i class="fa fa-long-arrow-alt-right"></i></f:case>
                    <f:case value="1"><i class="fa fa-long-arrow-alt-up"></i></f:case>
                    <f:case value="2"><i class="fa fa-long-arrow-alt-up"></i><i class="fa fa-long-arrow-alt-up"></i></f:case>
                    <f:case value="3"><i class="fa fa-long-arrow-alt-up"></i><i class="fa fa-long-arrow-alt-up"></i><i class="fa fa-long-arrow-alt-up"></i></f:case>
                </f:switch>
             </span>
        </f:then>
        <f:else>
        <span class="p-1 col-xs-2 {class}">--</span>
        </f:else>
    </f:if>

</f:section>
